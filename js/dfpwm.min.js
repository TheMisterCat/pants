// dfpwm.min.js - browser compatible version
// Adapted from MCJack123/node-dfpwm

export class DfpwmDecoder {
  constructor() {
    this.lastSample = 0;
  }

  // Decode a single byte
  decodeByte(byte) {
    let output = new Array(8);
    for (let i = 0; i < 8; i++) {
      let bit = (byte >> i) & 1;
      let delta = bit ? 1 : -1;
      this.lastSample += delta;
      output[i] = this.lastSample / 255; // normalize to -1..1
    }
    return output;
  }

  // Decode a Uint8Array to Float32Array
  decode(data) {
    const out = new Float32Array(data.length * 8);
    for (let i = 0; i < data.length; i++) {
      const decoded = this.decodeByte(data[i]);
      out.set(decoded, i * 8);
    }
    return out;
  }
}
